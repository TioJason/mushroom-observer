<%
  logged_in = !@user.nil? && @user.verified
  consensus = observation.consensus_naming
  any_names = observation.namings && observation.namings.count > 0
%>

<!--TABLE OF NAMES FOR WIDE SCREEN-->
<div class="hidden-xs">
  <%= form_tag(add_query_param(controller: :vote, action: :cast_votes,
      id: observation.id), id: "cast_votes_1") do %>

    <div class="row table-namings">
      <div class="col-sm-6">
        <%= content_tag(:h4,
	    any_names ? :show_namings_proposed_names.t : :show_namings_no_names_yet.t) %>
      </div>
      <div class="col-sm-2 push-down"><%= :show_namings_date_proposed.t %></div>
      <div class="col-sm-2 push-down"><%= :show_namings_user.t %></div>
      <div class="col-sm-2"><%= link_with_query(:show_namings_more.t, {
	       controller: :naming,
	       action: :create,
	       id: observation.id},
	       class: "btn pull-right push-down") %>
      </div>
    </div>
    <div class="list-group">
      <% observation.namings.sort_by(&:created_at).reverse.each do |naming| %>
        <% Textile.register_name(naming.name) %>
        <div class="list-group-item">
          <div class="row">
            <div class="col-sm-6">
              <%= link_with_query(naming.format_name.t,
                  controller: :name, action: :show_name,
                  id: naming.name) %>
    	    </div>
            <div class="col-sm-2">
    	      <%= naming.created_at.strftime("%Y-%m-%d") %>
    	    </div>
            <div class="col-sm-2">
              <strong><%= user_link(naming.user, naming.user.login) %></strong>
    	    </div>
            <div class="col-sm-2">
    	      <% if observation.is_owners_favorite?(naming) %>
                <b><%= :show_observation_owner_id.t +
    		       (naming == consensus ? ", " : "") %></b>
	      <% end %>
              <b><%= :show_observation_site_id.t if naming == consensus %></b>
    	    </div>
          </div>
	</div>
      <% end # each_name %>
    </div>
    <!--/TABLE OF NAMES FOR WIDE SCREEN-->

  <% end %>
</div>

<!--TABLE OF NAMES FOR MOBILE-->
<div class="visible-xs">
  <%= form_tag(add_query_param(controller: :vote, action: :cast_votes,
               id: observation.id), id: "cast_votes_2") do %>

    <div class="row visible-xs">
      <div class="col-xs-12">
        <%= content_tag(:h4, any_names ? :show_namings_proposed_names.t : :show_namings_no_names_yet.t) %>
        <% if any_names %>
          <div class="list-group">
            <% observation.namings.sort_by(&:created_at).reverse.each do |naming| %>
              <% Textile.register_name(naming.name) %>
              <div class="list-group-item">
                <div class="row">
                  <div class="col-xs-12">
                    <%= link_with_query(naming.format_name.t,
                                        controller: :name, action: :show_name,
                                        id: naming.name) %>
                  </div>
                  <div class="col-xs-6">
		    <% if observation.is_owners_favorite?(naming) %>
                      <%= :show_observation_owner_id.t +
		          (naming == consensus ? ", " : "") %>
		    <% end %>
		    <%= :show_observation_site_id.t if naming == consensus %>
		  </div>
		  <div class="col-xs-6">
		    Proposed by
                    <strong>
		      <%= user_link(naming.user, naming.user.login) %>
		    </strong>
		    on
		    <%= naming.created_at.strftime("%Y-%m-%d") %>
                  </div>
                </div>
              </div>
            <% end # each_name %>
          </div>
        <% end # any_names %>
      </div>
    </div>
    <!--/TABLE OF NAMES FOR MOBILE-->
  <% end # form %>
</div>

<!--VOTE POPUPS-->
<div class="row">
  <% observation.namings.select { |naming| naming.votes.count > 0 }.each do |naming|
    @naming = naming %>
    <div class="popup" id="show_votes_<%= naming.id %>" data-role="popup">
      <div class="popup-frame" id="show_votes_<%= naming.id %>_frame">
        <%= render(partial: "vote/show_votes",
                   locals: { do_cancel: true, naming: @naming }) %>
      </div>
    </div>
  <% end %>
</div>
<% inject_javascript_at_end %(
  VotePopupModule('#{j :show_namings_lose_changes.l.gsub("\n", " ")}')
) %>
<!--/VOTE POPUPS-->
